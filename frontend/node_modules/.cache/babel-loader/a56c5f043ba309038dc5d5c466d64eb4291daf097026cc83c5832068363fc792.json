{"ast":null,"code":"import React,{useEffect}from\"react\";import styles from\"./AddPostPage.module.scss\";import{useDispatch,useSelector}from\"react-redux\";import{selectIsAuth}from\"../../Redux/slices/sliceAuth\";import{Navigate,useNavigate,useParams}from\"react-router\";import axios from\"../../API/axios\";import CustomLoader from\"../../components/Loader/CustomLoader\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const AddPostPage=()=>{const{id}=useParams();const navigate=useNavigate();const isAuth=useSelector(selectIsAuth);const isEditing=Boolean(id);const[loading,setLoading]=React.useState(true);const[error,setError]=React.useState(\"\");const[fields,setFields]=React.useState({title:\"\",tags:\"\",text:\"\",imageUrl:\"\"});const fileRef=React.useRef(null);const handleChangeInput=async event=>{try{const formData=new FormData();formData.append(\"image\",event.target.files[0]);const{data}=await axios.post(\"/upload\",formData);setFields({...fields,imageUrl:data.url});}catch(err){console.log(err);}};const onClickCreatePost=async()=>{try{const params={title:fields.title,text:fields.text,tags:fields.tags.split(\" \"),imageUrl:fields.imageUrl};setLoading(true);const{data}=isEditing?await axios.patch(\"/posts/\"+id,params):await axios.post(\"/posts\",params);const _id=isEditing?id:data._id;navigate(\"/post/\".concat(_id));console.log(params);}catch{alert(\"Something's wrong\");}};useEffect(()=>{if(!isAuth&&!window.localStorage.getItem(\"token\")){return/*#__PURE__*/_jsx(Navigate,{to:\"/signin\"});}if(isEditing){axios.get(\"/posts/\".concat(id)).then(_ref=>{let{data}=_ref;return setFields({title:data.title,text:data.text,tags:data.tags.join(\" \"),imageUrl:data.imageUrl});}).catch(err=>{console.log(err);}).finally(()=>{setError(\"error\");setLoading(false);});}},[]);return/*#__PURE__*/_jsx(_Fragment,{children:!loading?!error?/*#__PURE__*/_jsx(\"div\",{style:{width:\"100%\",background:\"white\",borderRadius:\"3px\"},children:/*#__PURE__*/_jsxs(\"div\",{className:styles.createdPost,children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>fileRef.current.click(),className:\"button\",children:\"Download Picture\"}),fields.imageUrl&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{width:250,height:250,src:\"http://localhost:4000\".concat(fields.imageUrl)}),/*#__PURE__*/_jsx(\"button\",{className:styles.remove,style:{border:\"none\"},onClick:()=>setFields({...fields,imageUrl:\"\"}),children:\"Delete\"})]}),/*#__PURE__*/_jsx(\"input\",{ref:fileRef,type:\"file\",onChange:handleChangeInput,hidden:true}),/*#__PURE__*/_jsx(\"input\",{className:styles.createdPost__title,value:fields.title,onChange:e=>setFields({...fields,title:e.target.value}),placeholder:\"Article title...\"}),/*#__PURE__*/_jsx(\"input\",{className:styles.createdPost__tags,placeholder:\"tags\",value:fields.tags,onChange:e=>{setFields({...fields,tags:e.target.value});}}),/*#__PURE__*/_jsx(\"textarea\",{onChange:e=>setFields({...fields,text:e.target.value}),value:fields.text}),/*#__PURE__*/_jsx(\"button\",{onClick:onClickCreatePost,className:\"button-reverse\",children:!isEditing?\"Create\":\"Save\"})]})}):/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\",padding:\"50px 0\"},children:\"Not Found\\uD83D\\uDE05\"}):/*#__PURE__*/_jsx(CustomLoader,{})});};export default AddPostPage;","map":{"version":3,"names":["React","useEffect","styles","useDispatch","useSelector","selectIsAuth","Navigate","useNavigate","useParams","axios","CustomLoader","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AddPostPage","id","navigate","isAuth","isEditing","Boolean","loading","setLoading","useState","error","setError","fields","setFields","title","tags","text","imageUrl","fileRef","useRef","handleChangeInput","event","formData","FormData","append","target","files","data","post","url","err","console","log","onClickCreatePost","params","split","patch","_id","concat","alert","window","localStorage","getItem","to","get","then","_ref","join","catch","finally","children","style","width","background","borderRadius","className","createdPost","onClick","current","click","height","src","remove","border","ref","type","onChange","hidden","createdPost__title","value","e","placeholder","createdPost__tags","textAlign","padding"],"sources":["C:/Users/skaullin62/Desktop/ReactAppsTS/fullstack/frontend/src/pages/AddPostPage/AddPostPage.jsx"],"sourcesContent":["import React, { useEffect } from \"react\";\r\nimport styles from \"./AddPostPage.module.scss\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { selectIsAuth } from \"../../Redux/slices/sliceAuth\";\r\nimport { Navigate, useNavigate, useParams } from \"react-router\";\r\nimport axios from \"../../API/axios\";\r\nimport CustomLoader from \"../../components/Loader/CustomLoader\";\r\nconst AddPostPage = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const isAuth = useSelector(selectIsAuth);\r\n  const isEditing = Boolean(id);\r\n  const [loading, setLoading] = React.useState(true);\r\n  const [error, setError] = React.useState(\"\");\r\n  const [fields, setFields] = React.useState({\r\n    title: \"\",\r\n    tags: \"\",\r\n    text: \"\",\r\n    imageUrl: \"\",\r\n  });\r\n  const fileRef = React.useRef(null);\r\n\r\n  const handleChangeInput = async (event) => {\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"image\", event.target.files[0]);\r\n      const { data } = await axios.post(\"/upload\", formData);\r\n      setFields({ ...fields, imageUrl: data.url });\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const onClickCreatePost = async () => {\r\n    try {\r\n      const params = {\r\n        title: fields.title,\r\n        text: fields.text,\r\n        tags: fields.tags.split(\" \"),\r\n        imageUrl: fields.imageUrl,\r\n      };\r\n      setLoading(true);\r\n      const { data } = isEditing\r\n        ? await axios.patch(\"/posts/\" + id, params)\r\n        : await axios.post(\"/posts\", params);\r\n      const _id = isEditing ? id : data._id;\r\n      navigate(`/post/${_id}`);\r\n      console.log(params);\r\n    } catch {\r\n      alert(\"Something's wrong\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isAuth && !window.localStorage.getItem(\"token\")) {\r\n      return <Navigate to=\"/signin\" />;\r\n    }\r\n    if (isEditing) {\r\n      axios\r\n        .get(`/posts/${id}`)\r\n        .then(({ data }) =>\r\n          setFields({\r\n            title: data.title,\r\n            text: data.text,\r\n            tags: data.tags.join(\" \"),\r\n            imageUrl: data.imageUrl,\r\n          })\r\n        )\r\n        .catch((err) => {\r\n          console.log(err);\r\n        })\r\n        .finally(() => {\r\n          setError(\"error\");\r\n          setLoading(false);\r\n        });\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      {!loading ? (\r\n        !error ? (\r\n          <div\r\n            style={{ width: \"100%\", background: \"white\", borderRadius: \"3px\" }}\r\n          >\r\n            <div className={styles.createdPost}>\r\n              <button\r\n                onClick={() => fileRef.current.click()}\r\n                className=\"button\"\r\n              >\r\n                Download Picture\r\n              </button>\r\n\r\n              {fields.imageUrl && (\r\n                <div>\r\n                  <img\r\n                    width={250}\r\n                    height={250}\r\n                    src={`http://localhost:4000${fields.imageUrl}`}\r\n                  />\r\n                  <button\r\n                    className={styles.remove}\r\n                    style={{ border: \"none\" }}\r\n                    onClick={() => setFields({ ...fields, imageUrl: \"\" })}\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              )}\r\n              <input\r\n                ref={fileRef}\r\n                type=\"file\"\r\n                onChange={handleChangeInput}\r\n                hidden\r\n              />\r\n              <input\r\n                className={styles.createdPost__title}\r\n                value={fields.title}\r\n                onChange={(e) =>\r\n                  setFields({\r\n                    ...fields,\r\n                    title: e.target.value,\r\n                  })\r\n                }\r\n                placeholder=\"Article title...\"\r\n              />\r\n              <input\r\n                className={styles.createdPost__tags}\r\n                placeholder=\"tags\"\r\n                value={fields.tags}\r\n                onChange={(e) => {\r\n                  setFields({\r\n                    ...fields,\r\n                    tags: e.target.value,\r\n                  });\r\n                }}\r\n              />\r\n              <textarea\r\n                onChange={(e) =>\r\n                  setFields({\r\n                    ...fields,\r\n                    text: e.target.value,\r\n                  })\r\n                }\r\n                value={fields.text}\r\n              />\r\n              <button onClick={onClickCreatePost} className=\"button-reverse\">\r\n                {!isEditing ? \"Create\" : \"Save\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <h2 style={{ textAlign: \"center\", padding: \"50px 0\" }}>\r\n            Not FoundðŸ˜…\r\n          </h2>\r\n        )\r\n      ) : (\r\n        <CustomLoader />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AddPostPage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}